---
title: "Small RNA-seq quality control"
author: "`r getOption('author')`"
date: "`r Sys.Date()`"
---

```{r setup, message=FALSE}
# Run [bcbioRnaseq::download()] to download `setup.R`
source("setup.R")
library(isomiRs)
library(bcbioSmallRna)

# bcbioSmallRnaDataSet
bcb <- loadSmallRnaRun(
    upload_dir = file.path("data", "final"),
    interesting_groups = c("genotype", "treatment"),
    dataDir = data_out)
```

```{r header, child="header.Rmd"}
```



# Exploratory analysis

In this section we will see descriptive figures about quality of the data, 
reads with adapter, reads mapped to miRNAs, reads mapped to other small RNAs. 


## Size distribution

After adapter removal, we can plot the size distribution of the small RNAs.
We expect the majority of reads to have adapters and we expect a peak
at 22 (maybe 33 as well) that indicates miRNA/tRNA enrichment. There
are some cases this rule won't apply.

```{r adapter}
bcbSmallSize(bcb)
```


## miRNA

A microRNA (abbreviated miRNA) is a small non-coding RNA molecule (containing about 22 nucleotides) found in plants, animals and some viruses, that functions in RNA silencing and post-transcriptional regulation of gene expression.[https://en.wikipedia.org/wiki/MicroRNA]

### Total miRNA expression annotated with mirbase

[miRBase](www.mirbase.org) is one of the database that contains the reference miRNA sequences.

```{r plot_mirna_counts, fig.height=9}
bcbSmallMicro(bcb)
```

### Clustering of samples

```{r mirna-pca}
bcbSmallPCA(bcb)
```


## isomiRs

isomiR is a term coined by Morin et al. to refer to those sequences that have variations with respect to the reference MiRNA sequence. [https://en.wikipedia.org/wiki/IsomiR]

There are 5 different types of isomiRs:

* ref: perfect match to the sequence on the database
* t3: nucleotides changes at 3'
* t5: nucleotides changes at 5'
* add: nucleotides addition at the 3'
* mism: putatives SNPs

![](http://ars.els-cdn.com/content/image/1-s2.0-S0168952512001126-gr1.jpg)

```{r isomiRs, eval=ismirbase, fig.cap="Proportion of isomiRs counting reads (left) or unique sequences (right)."}
ids <- bcbio(bcb, "isomirs")
isoPlot(ids, type = "all", column = "group")
```


## Small RNA clusters

We use [seqcluster](http://seqcluster.readthedocs.io/getting_started.html) to identify any type of small RNA. It generates a list of clusters of small RNA sequences, their genome location, their annotation and the abundance in all the sample of the project. The next figure explain the algorithm used for that and the way to use it for differential expression analyses.

![](http://seqcluster.readthedocs.io/_images/seqcluster.png)


```{r plot_srna_clusters, fig.width=7, fig.height=9, fig.cap="Reads kept after each filering step(top left). Proportion of sequences detected (top right). Count distribution (bottom)."}
bcbSmallCluster(bcb)
```


### Clustering of samples

```{r clusters-pca}
bcbSmallPCA(bcb, "cluster")
```

```{r footer, child="footer.Rmd"}
```
